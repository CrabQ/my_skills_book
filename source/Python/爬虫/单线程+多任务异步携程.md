# 单线程+多任务异步携程

```python
# 携程:在函数定义的时候使用async修饰, 函数调用后返回一个携程对象,函数内部的语句不会立即执行

# 任务对象: 对协程对象的进一步封装,必须注册到事件循环中,绑定回调

# 事件循环: 相当于容器,存放任务对象,启动后异步执行任务对象


import asyncio
import time

# 回调函数
def callback(task):
    print('callback', task.result())

async def test(num):
    print(f'test{num}')
    await asyncio.sleep(3)
    return f'test{num}'

start_time = time.time()

tasks = []
for i in range(3):
    t = test(i)
    # 封装一个任务对象
    task = asyncio.ensure_future(t)
    # 添加回调
    task.add_done_callback(callback)
    tasks.append(task)

# 创建一个事件循环的对象
loop = asyncio.get_event_loop()
# 任务对象注册
loop.run_until_complete(asyncio.wait(tasks))

print('all:', time.time()-start_time)
# test0# test1
# test2
# callback test0
# callback test1
# callback test2
# all: 3.0028576850891113
```

## aiohttp

```python
# 支持异步
import aiohttp

async def test(url):
    async with aiohttp.ClientSession() as s:
        async with await s.get(url) as response:
            page_text = await response.text()
    return page_text
```
