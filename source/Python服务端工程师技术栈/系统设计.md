# 系统设计

## 什么是系统设计

    系统设计是一个定义系统架构,模块,接口和数据满足特定需求的过程
    比如设计一个短网址服务,评论服务,Feed流系统,抢红包系统
    微服务架构很多系统被按照业务拆分,需要单独设计一个系统服务

### 系统设计的难点

    需要具备相关领域,算法的经验,有一定的架构设计能力
    熟悉后端技术组件,比如消息队列,缓存,数据库,框架
    具备文档撰写,流程图绘制,架构设计,编码实现等综合能力

### 系统设计的要素

    使用场景和限制条件
    数据储存设计
    算法模块设计

#### 要素之一:场景和限制

    这个系统是在什么地方使用的?比如短网址系统提供给站内各种服务生成短网址
    限制条件:用户估计有多少,至少要能支撑多少用户(服务)?
    估算并发qps:峰值qps是多少?平均qps是多少?

#### 要素之二:数据存储设计

    按需设计数据表,需要哪些字段,使用什么类型?数据增长规模
    数据库选型:是否需要持久化?使用关系型还是NoSQL?
    如何优化?如何设计索引?是否可以使用缓存?

#### 要素之三:算法模块设计

算法解决问题的核心.程序=算法+数据结构. 系统=服务+存储

    需要哪些接口?接口如何设计
    使用什么算法或者模型?
    不同实现方式之间的优劣对比,如何取舍?

#### 延伸

    用户多了,qps高了如何处理?
    数据储存多了不够存了如何处理?
    故障如何处理?单点失败,多点失败,血崩问题

## 短网址系统的设计与实现

### 什么是短网址系统?

TinyUrl Service

    把一个长网址转成短网址的服务
    比如 https://bitly.com/
    转换之后的网址后缀不超过7位(字符或者数字)

### 场景和限制

使用场景:提供短网址服务为公司其他各业务服务

    功能:一个长网址转成短网址并储存;根据短网址还原长url
    要求短网址的后缀不超过7位(大小写字母和数字)
    预估峰值插入请求数量级:数百;查询请求数量级:数千

### 算法实现设计

    两个API:long2short_url, short2long_url
    常用算法:hash算法截取;自增序列算法
    对比多种算法,我们采取自增序列算法实现

### 编码实现

使用Flask框架演示

    代码里实现了短网址生成算法
    数据库使用MySQL
    计数器使用Redis
